"use strict";(self["webpackChunkwms_web"]=self["webpackChunkwms_web"]||[]).push([[882,213,20],{1213:function(e,t,s){s.r(t),s.d(t,{default:function(){return h}});var i=function(){var e=this,t=e._self._c;return t("div",[t("el-row",{staticStyle:{display:"flex","justify-content":"space-between","min-height":"94vh"}},[t("el-col",{attrs:{span:4}},[t("el-card",{staticStyle:{height:"100%","overflow-y":"auto",color:"#333"}},[t("div",{staticStyle:{"padding-bottom":"10px","border-bottom":"1px solid #ccc"}}),t("el-button",{staticStyle:{width:"100%",padding:"10px 0","margin-top":"10px"},attrs:{disabled:!0}},[t("el-avatar",{staticStyle:{"margin-right":"12px"},attrs:{size:40,src:this.user.avatar}},[e._v("我")]),t("span",{staticStyle:{"font-size":"1.1vw",position:"relative",top:"-12px"}},[e._v(e._s(this.user.name))])],1),e._l(e.users.concat(e.usersHistory),(function(s){return t("div",{key:s.username,staticStyle:{padding:"10px 0","text-align":"center"},on:{click:function(t){return e.history(s.username)}}},[t("el-badge",{staticStyle:{width:"100%"},attrs:{value:s.newMessage,max:10,hidden:0===s.newMessage}},[t("el-button",{staticStyle:{width:"100%"}},[t("el-avatar",{staticStyle:{"margin-right":"12px"},attrs:{size:40,src:s.avatar}},[e._v(" "+e._s(s.username.charAt(0))+" ")]),s.username!==e.chatUser?t("span",{staticStyle:{"font-size":"1.1vw",position:"relative",top:"-12px"}},[e._v(e._s(s.name))]):e._e(),s.username===e.chatUser?t("span",{staticStyle:{"font-size":"1.1vw","font-weight":"bold",color:"limegreen",position:"relative",top:"-12px"}},[e._v(e._s(s.name))]):e._e(),t("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"在线用户",placement:"right"}},[1===s.online?t("i",{staticClass:"el-icon-connection el-icon--right",staticStyle:{position:"relative",top:"-12px"}}):e._e()])],1)],1)],1)}))],2)],1),t("el-col",{attrs:{span:24}},[t("div",{staticStyle:{height:"100%",display:"flex","align-items":"center","flex-direction":"column"},style:{"background-image":"url("+this.chatBack+")"}},[t("div",{staticStyle:{"text-align":"center","line-height":"50px","font-size":"large","font-weight":"bold","margin-bottom":"-20px"}},[e._v(" "+e._s(e.chatUser?e.chatUser:"请选择用户")+" ")]),t("el-divider"),t("div",{ref:"scrollDiv",staticStyle:{height:"68vh",width:"75%",overflow:"auto","margin-bottom":"10px"},domProps:{innerHTML:e._s(e.content)}}),t("div",{staticStyle:{width:"100%",display:"flex","justify-items":"center","justify-content":"center"}},[t("el-input",{staticStyle:{width:"35%","font-size":"large"},attrs:{autosize:{minRows:2,maxRows:3},placeholder:"请输入内容",resize:"none","show-word-limit":"",type:"textarea"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.send.apply(null,arguments)}},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),t("el-button",{staticClass:"sendButton",staticStyle:{"font-size":"1em","border-radius":"0 20px 20px 0","box-shadow":"0 5px 20px 0 rgba(0, 0, 0, 0.3)"},attrs:{size:"medium",type:"primary"},on:{click:e.send}},[e._v("发送")])],1)],1)])],1)],1)},a=[];s(7658);let n;var r={name:"Chat",data(){return{circleUrl:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",chatBack:s(7844),user:JSON.parse(sessionStorage.getItem("CurUser")),isCollapse:!1,users:[],usersHistory:[],historyChat:[],chatUser:"",text:"",messages:[],content:""}},beforeMount(){this.user=JSON.parse(sessionStorage.getItem("CurUser"))},created(){this.init()},methods:{history(e){this.chatUser=e,this.content="",this.users.forEach((t=>{t.username===e&&(t.newMessage=0)})),this.$axios.post(this.$httpUrl+"/message/history",{pageSize:"",pageNum:"",param:{user1:e,user2:this.user.no}}).then((e=>e.data)).then((t=>{200===t.code&&(this.historyChat=t.data,this.historyChat.forEach((t=>{t.fromNo===e?this.createContent(t.fromAvatar?t.fromAvatar:this.circleUrl,null,t.content):this.createContent(null,this.user.avatar?this.user.avatar:this.circleUrl,t.content)})))}))},send(){if(this.chatUser)if(this.text&&""!==this.text)if("undefined"==typeof WebSocket)console.log("您的浏览器不支持WebSocket");else{console.log("您的浏览器支持WebSocket");let e={from:this.user.no,to:this.chatUser,text:this.text};n.send(JSON.stringify(e)),this.messages.push({user:this.user.no,text:this.text}),this.createContent(null,this.user.avatar?this.user.avatar:this.circleUrl,this.text),this.text=""}else this.$message({type:"warning",message:"请输入内容"});else this.$message({type:"warning",message:"请选择左侧聊天对象"})},createContent(e,t,s){let i;t?i='<div class="el-row" style="padding: 5px 0">\n  <div class="el-col el-col-22" style="text-align: right; padding-right: 10px">\n    <div style="color: white; text-align: center; border-radius: 10px; font-family: sans-serif; padding: 10px; width:auto; max-width: 25vw; word-wrap: break-word; display:inline-block !important; box-shadow: 0 5px 20px 1px rgba(0, 0, 0, 0.3); background-color: forestgreen;">'+s+'</div>\n  </div>\n  <div class="el-col el-col-2">\n  <span class="el-avatar el-avatar--circle" style="height: 40px; width: 40px; line-height: 40px;">\n    <img src="'+t+'" style="object-fit: cover;">\n  </span>\n  </div>\n</div>':e&&(i='<div class="el-row" style="padding: 5px 0">\n  <div class="el-col el-col-2" style="text-align: right">\n  <span class="el-avatar el-avatar--circle" style="height: 40px; width: 40px; line-height: 40px;">\n    <img src="'+e+'" style="object-fit: cover;">\n  </span>\n  </div>\n  <div class="el-col el-col-22" style=" text-align: left; padding-left: 10px">\n    <div style="color: white; text-align: center; border-radius: 10px; font-family: sans-serif; padding: 10px; width:auto; max-width: 25vw; word-wrap: break-word; display:inline-block !important; box-shadow: 0 5px 20px 1px rgba(0, 0, 0, 0.3); background-color: deepskyblue;">'+s+"</div>\n  </div>\n</div>"),this.content+=i,this.$nextTick((()=>{const e=this.$refs.scrollDiv;e.scrollTop=e.scrollHeight}))},init(){let e=this.user.no;console.log("当前用户："+e);let t=this;if("undefined"==typeof WebSocket)console.log("您的浏览器不支持WebSocket");else{console.log("您的浏览器支持WebSocket");let s="wss://"+this.$httpUrl.replace("https://","").replace(/\s/g,"")+"/imserver/"+e;null!=n&&(n.close(),n=null),n=new WebSocket(s),n.onopen=function(){console.log("websocket已打开")},n.onmessage=function(s){let i=JSON.parse(s.data);i.users&&(t.users=i.users.filter((t=>t.username!==e))),i.usersHistory&&(t.usersHistory=i.usersHistory,!t.chatUser&&i.users.length>1&&t.history(i.users.filter((t=>t.username!==e))[0].username)),i.users||(i.from===t.chatUser?(t.messages.push(i),t.createContent(i.avatar?i.avatar:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",null,i.text)):t.users.forEach((e=>{e.username===i.from&&(e.newMessage+=1)})))},n.onclose=function(){console.log("websocket已关闭")},n.onerror=function(){console.log("websocket发生了错误")}}}}},o=r,l=s(1001),c=(0,l.Z)(o,i,a,!1,null,"22669f10",null),h=c.exports},3882:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var i=function(){var e=this,t=e._self._c;return t("div",[e.isMobile?e._e():t("Chat"),e.isMobile?t("ChatMobile"):e._e()],1)},a=[],n=s(1213),r=s(8020),o={name:"ChatAll",components:{ChatMobile:r["default"],Chat:n["default"]},data(){return{isMobile:!1}},methods:{checkIfMobile(){this.isMobile=window.innerWidth<800}},mounted(){this.checkIfMobile()}},l=o,c=s(1001),h=(0,c.Z)(l,i,a,!1,null,"46436ae4",null),d=h.exports},8020:function(e,t,s){s.r(t),s.d(t,{default:function(){return h}});var i=function(){var e=this,t=e._self._c;return t("div",[t("el-row",{staticStyle:{display:"flex","justify-content":"space-between",height:"calc(100vh - 70px)"}},[t("el-col",{staticStyle:{"margin-right":"5px"},attrs:{span:4}},[t("el-card",{staticStyle:{height:"100%","background-color":"#f3f3f3","overflow-y":"auto",color:"#333"}},[t("div",{staticStyle:{"text-align":"center"}},[t("el-avatar",{attrs:{size:40,src:this.user.avatar}},[e._v("我")])],1),e._l(e.users,(function(s){return t("div",{key:s.username,staticStyle:{padding:"5px 0","text-align":"center"},on:{click:function(t){return e.history(s.username)}}},[t("el-badge",{staticStyle:{width:"100%"},attrs:{value:s.newMessage,max:10,hidden:0===s.newMessage}},[t("el-avatar",{attrs:{size:40,src:s.avatar}},[e._v(" "+e._s(s.username.charAt(0))+" ")])],1)],1)}))],2)],1),t("el-col",{attrs:{span:24}},[t("div",{staticStyle:{height:"100%",display:"flex","align-items":"center","flex-direction":"column"}},[t("div",{staticStyle:{"text-align":"center","line-height":"30px","font-size":"large","font-weight":"bold","margin-bottom":"10px"}},[e._v(" "+e._s(e.chatUser?e.chatUser:"请选择用户")+" ")]),t("div",{ref:"scrollDiv",staticStyle:{height:"68vh",width:"100%",overflow:"auto","margin-bottom":"10px"},domProps:{innerHTML:e._s(e.content)}}),t("div",{staticStyle:{position:"fixed",bottom:"30px"}},[t("div",{staticStyle:{width:"100%",display:"flex","justify-items":"center","justify-content":"center"}},[t("el-input",{staticStyle:{width:"70%","font-size":"medium"},attrs:{autosize:{minRows:2,maxRows:3},placeholder:"消息",resize:"none","show-word-limit":"",type:"textarea"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.send.apply(null,arguments)}},model:{value:e.text,callback:function(t){e.text=t},expression:"text"}}),t("el-button",{staticClass:"sendButton",staticStyle:{"font-size":"1em","border-radius":"0 20px 20px 0","box-shadow":"0 5px 20px 0 rgba(0, 0, 0, 0.3)"},attrs:{size:"mini",type:"primary"},on:{click:e.send}},[e._v("发送")])],1)])])])],1)],1)},a=[];s(7658);let n;var r={name:"ChatMobile",data(){return{circleUrl:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",chatBack:s(7844),user:JSON.parse(sessionStorage.getItem("CurUser")),isCollapse:!1,users:[],historyChat:[],chatUser:"",text:"",messages:[],content:""}},beforeMount(){this.user=JSON.parse(sessionStorage.getItem("CurUser"))},created(){this.init()},methods:{history(e){this.chatUser=e,this.content="",this.users.forEach((t=>{t.username===e&&(t.newMessage=0)})),this.$axios.post(this.$httpUrl+"/message/history",{pageSize:"",pageNum:"",param:{user1:e,user2:this.user.no}}).then((e=>e.data)).then((t=>{200===t.code&&(this.historyChat=t.data,this.historyChat.forEach((t=>{t.fromNo===e?this.createContent(t.fromAvatar?t.fromAvatar:this.circleUrl,null,t.content):this.createContent(null,this.user.avatar?this.user.avatar:this.circleUrl,t.content)})))}))},send(){if(this.chatUser)if(this.text&&""!==this.text)if("undefined"==typeof WebSocket)console.log("您的浏览器不支持WebSocket");else{console.log("您的浏览器支持WebSocket");let e={from:this.user.no,to:this.chatUser,text:this.text};n.send(JSON.stringify(e)),this.messages.push({user:this.user.no,text:this.text}),this.createContent(null,this.user.avatar?this.user.avatar:this.circleUrl,this.text),this.text=""}else this.$message({type:"warning",message:"请输入内容"});else this.$message({type:"warning",message:"请选择左侧聊天对象"})},createContent(e,t,s){let i;t?i='<div class="el-row" style="padding: 5px 0; margin-right: 5px;">\n  <div class="el-col el-col-22" style="text-align: right; padding-right: 5px">\n    <div style="color: white; text-align: center; border-radius: 10px; font-family: sans-serif; padding: 5px; width:auto; max-width: 50vw; word-wrap: break-word; display:inline-block !important; box-shadow: 0 5px 20px 1px rgba(0, 0, 0, 0.3); background-color: forestgreen;">'+s+'</div>\n  </div>\n  <div class="el-col el-col-2">\n  <span class="el-avatar el-avatar--circle" style="height: 30px; width: 30px; line-height: 40px;">\n    <img src="'+t+'" style="object-fit: cover;">\n  </span>\n  </div>\n</div>':e&&(i='<div class="el-row" style="padding: 5px 0;">\n  <div class="el-col el-col-2" style="text-align: right">\n  <span class="el-avatar el-avatar--circle" style="height: 30px; width: 30px; line-height: 40px;">\n    <img src="'+e+'" style="object-fit: cover;">\n  </span>\n  </div>\n  <div class="el-col el-col-22" style=" text-align: left; padding-left: 10px">\n    <div style="color: white; text-align: center; border-radius: 10px; font-family: sans-serif; padding: 5px; width:auto; max-width: 50vw; word-wrap: break-word; display:inline-block !important; box-shadow: 0 5px 20px 1px rgba(0, 0, 0, 0.3); background-color: deepskyblue;">'+s+"</div>\n  </div>\n</div>"),this.content+=i,this.$nextTick((()=>{const e=this.$refs.scrollDiv;e.scrollTop=e.scrollHeight}))},init(){let e=this.user.no;console.log("当前用户："+e);let t=this;if("undefined"==typeof WebSocket)console.log("您的浏览器不支持WebSocket");else{console.log("您的浏览器支持WebSocket");let s="wss://"+this.$httpUrl.replace("https://","").replace(/\s/g,"")+"/imserver/"+e;null!=n&&(n.close(),n=null),n=new WebSocket(s),n.onopen=function(){console.log("websocket已打开")},n.onmessage=function(s){console.log("收到数据===="+s.data);let i=JSON.parse(s.data);i.users?(t.users=i.users.filter((t=>t.username!==e)),!t.chatUser&&i.users.length>1&&t.history(i.users.filter((t=>t.username!==e))[0].username)):i.from===t.chatUser?(t.messages.push(i),t.createContent(i.avatar?i.avatar:"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",null,i.text)):t.users.forEach((e=>{e.username===i.from&&(e.newMessage+=1)}))},n.onclose=function(){console.log("websocket已关闭")},n.onerror=function(){console.log("websocket发生了错误")}}}}},o=r,l=s(1001),c=(0,l.Z)(o,i,a,!1,null,"471bdf6e",null),h=c.exports},7844:function(e,t,s){e.exports=s.p+"img/chatBack.02c51374.jpg"}}]);
//# sourceMappingURL=882.d9773000.js.map