"use strict";(self["webpackChunkwms_web"]=self["webpackChunkwms_web"]||[]).push([[575],{1575:function(t,e,i){i.r(e),i.d(e,{default:function(){return p}});var s=function(){var t=this,e=t._self._c;return e("div",[e("el-tabs",{attrs:{type:"border-card"}},[e("el-tab-pane",{staticStyle:{"min-height":"85vh"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-date"}),t._v(" 我的文章")]),e("div",{staticStyle:{display:"flex","flex-direction":"column","justify-content":"center",margin:"20px"}},[e("div",{staticStyle:{display:"flex","justify-content":"center"}},[e("el-input",{staticStyle:{width:"400px"},attrs:{clearable:"",placeholder:"查询帖子"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.searchLoad.apply(null,arguments)}},model:{value:t.text,callback:function(e){t.text=e},expression:"text"}}),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{circle:"",icon:"el-icon-search"},on:{click:t.searchLoad}}),e("el-button",{attrs:{circle:"",icon:"el-icon-refresh-left",type:"info"},on:{click:t.restParam}})],1),t.isMobile?t._e():e("el-timeline",{staticClass:"timeline"},t._l(t.tableData,(function(i,s){return e("el-timeline-item",{key:s,attrs:{timestamp:new Date(i.post.time).toDateString(),placement:"top"}},[e("el-card",{staticClass:"box-card",staticStyle:{"min-height":"300px",margin:"20px"}},[e("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"space-between"},attrs:{slot:"header"},slot:"header"},[e("div",[e("el-avatar",{staticStyle:{margin:"0px 10px"},attrs:{size:40,src:i.post.avatar}},[t._v(t._s(i.post.userno.charAt(0)))]),t.isMobile?t._e():e("span",{staticStyle:{position:"relative",top:"-12px"}},[t._v(t._s(i.post.userno))])],1),e("div",{staticStyle:{position:"relative",left:"-25px"}},[e("span",{staticStyle:{"font-weight":"10","font-size":"16px",color:"#777777"}},[t._v(t._s(i.post.id)+".")]),e("span",{staticClass:"text2",staticStyle:{"padding-left":"10px"}},[t._v(t._s(i.post.title))])]),e("div",{staticStyle:{"font-weight":"10","font-size":"16px",position:"relative",top:"-5px"}},[t._v(" "+t._s(new Date(i.post.time).getMonth()+1)+"/"+t._s(new Date(i.post.time).getDate())+" "),e("br"),t._v(" "+t._s(new Date(i.post.time).getHours())+":"+t._s(new Date(i.post.time).getMinutes())+" ")])]),e("div",{staticClass:"text item",staticStyle:{"white-space":"pre-line",padding:"0px 15px","min-height":"150px"}},[e("div",{directives:[{name:"highlight",rawName:"v-highlight"}],staticClass:"ql-editor",domProps:{innerHTML:t._s(i.post.name)}})]),e("div",{staticStyle:{display:"flex","justify-content":"flex-end"}},[e("span",{staticStyle:{"font-weight":"bold",color:"#0043a1","text-shadow":"0px 2px 3px rgb(73,230,255)",position:"relative",top:"5px"}},[t._v(" "+t._s(i.post.likenum)+" ")]),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{circle:"",icon:"el-icon-thumb",size:"small",type:"success"},on:{click:function(e){return t.like(i.post.id)}}}),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{circle:"",icon:"el-icon-share",size:"small",type:"primary"},on:{click:function(e){return t.copy(i.post.name)}}}),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{icon:"el-icon-delete-solid",size:"small",type:"danger"},on:{click:function(e){return t.del(i.post.id)}}},[t._v("删除")])],1),t._l(i.post2,(function(s,a){return e("div",{key:a},[0===a?e("el-divider"):t._e(),e("div",{staticStyle:{width:"100%","min-height":"50px",display:"flex","justify-content":"space-between"}},[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("el-avatar",{staticStyle:{margin:"0px 10px"},attrs:{size:30,src:s.avatar,shape:"square"}},[t._v(t._s(i.post.userno.charAt(0)))]),e("div",[e("span",{staticStyle:{"font-size":"12px","font-weight":"lighter",color:"#6e6e6e"}},[t._v(" "+t._s(s.userName))]),2!==s.roleId?e("el-tag",{staticStyle:{"margin-left":"5px","font-size":"10px"},attrs:{size:"mini",type:0===s.roleId?"danger":1===s.roleId?"warning":"info",effect:"plain"}},[t._v(" "+t._s(0===s.roleId?"超管":1===s.roleId?" 管理员":" "))]):t._e(),e("br"),e("span",{staticStyle:{"font-size":"16px"}},[t._v(" "+t._s(s.content))])],1)],1),e("div",{staticStyle:{"font-weight":"10","font-size":"14px"}},[t._v(" "+t._s(new Date(s.time).getMonth()+1)+"/"+t._s(new Date(s.time).getDate())+" "+t._s(new Date(s.time).getHours())+":"+t._s(new Date(s.time).getMinutes())+" ")])])],1)}))],2)],1)})),1),t.isMobile?e("div",t._l(t.tableData,(function(i,s){return e("div",{key:s},[e("el-card",{staticClass:"box-card",staticStyle:{"min-height":"300px","margin-top":"10px"}},[e("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"space-between"},attrs:{slot:"header"},slot:"header"},[e("div",{staticClass:"text2",staticStyle:{"padding-left":"10px"}},[t._v(t._s(i.post.title))]),e("div",{staticStyle:{"font-weight":"10","font-size":"16px"}},[t._v(" "+t._s(new Date(i.post.time).getMonth()+1)+"/"+t._s(new Date(i.post.time).getDate())+" "),e("br"),t._v(" "+t._s(new Date(i.post.time).getHours())+":"+t._s(new Date(i.post.time).getMinutes())+" ")])]),e("div",{staticClass:"text item",staticStyle:{"white-space":"pre-line",padding:"0px 15px","min-height":"150px","max-height":"800px","overflow-y":"auto"}},[e("div",{directives:[{name:"highlight",rawName:"v-highlight"}],staticClass:"ql-editor",domProps:{innerHTML:t._s(i.post.name)}})]),e("div",{staticStyle:{display:"flex","justify-content":"flex-end"}},[e("span",{staticStyle:{"font-weight":"bold",color:"#0043a1","text-shadow":"0px 2px 3px rgb(73,230,255)",position:"relative",top:"5px"}},[t._v(" "+t._s(i.post.likenum)+" ")]),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{circle:"",icon:"el-icon-thumb",size:"small",type:"success"},on:{click:function(e){return t.like(i.post.id)}}}),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{circle:"",icon:"el-icon-share",size:"small",type:"primary"},on:{click:function(e){return t.copy(i.post.name)}}}),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{icon:"el-icon-delete-solid",size:"small",type:"danger"},on:{click:function(e){return t.del(i.post.id)}}},[t._v("删除")])],1),t._l(i.post2,(function(s,a){return e("div",{key:a},[0===a?e("el-divider"):t._e(),e("div",{staticStyle:{width:"100%","min-height":"50px",display:"flex","justify-content":"space-between"}},[e("div",{staticStyle:{display:"flex","align-items":"center"}},[e("el-avatar",{staticStyle:{margin:"0px 10px"},attrs:{size:30,src:s.avatar,shape:"square"}},[t._v(t._s(i.post.userno.charAt(0)))]),e("div",[e("span",{staticStyle:{"font-size":"12px","font-weight":"lighter",color:"#6e6e6e"}},[t._v(" "+t._s(s.userName))]),2!==s.roleId?e("el-tag",{staticStyle:{"margin-left":"5px","font-size":"10px"},attrs:{size:"mini",type:0===s.roleId?"danger":1===s.roleId?"warning":"info",effect:"plain"}},[t._v(" "+t._s(0===s.roleId?"超管":1===s.roleId?" 管理员":" "))]):t._e(),e("br"),e("span",{staticStyle:{"font-size":"16px"}},[t._v(" "+t._s(s.content))])],1)],1),e("div",{staticStyle:{"font-weight":"10","font-size":"14px"}},[t._v(" "+t._s(new Date(s.time).getMonth()+1)+"/"+t._s(new Date(s.time).getDate())+" "+t._s(new Date(s.time).getHours())+":"+t._s(new Date(s.time).getMinutes())+" ")])])],1)}))],2)],1)})),0):t._e(),0!==t.tableData.length?e("div",{staticStyle:{width:"100%",margin:"20px 0","text-align":"center"}},[e("el-button",{staticStyle:{width:"50%"},on:{click:t.autoLoad}},[t._v("更 多")])],1):t._e(),0===t.tableData.length?e("el-empty",[e("el-button",{attrs:{type:"success"},on:{click:t.update}},[t._v("发表文章 !")])],1):t._e()],1)]),e("el-tab-pane",{staticStyle:{"min-height":"85vh"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-chat-line-square"}),t._v(" 我的评论")]),e("div",{staticStyle:{display:"flex","flex-direction":"column","justify-content":"center",margin:"20px"}},[e("el-timeline",{staticClass:"timeline"},t._l(t.Post2tableData,(function(i,s){return e("el-timeline-item",{key:s,attrs:{timestamp:new Date(i.time).toDateString(),placement:"top"}},[e("el-card",{staticClass:"box-card",staticStyle:{margin:"20px"}},[e("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"space-between"},attrs:{slot:"header"},slot:"header"},[e("div",[e("el-avatar",{staticStyle:{margin:"0px 10px"},attrs:{size:40,src:i.avatar,shape:"square"}},[t._v(t._s(i.userName.charAt(0)))]),t.isMobile?t._e():e("span",{staticStyle:{position:"relative",top:"-12px"}},[t._v(t._s(i.userName))])],1),e("div",{staticStyle:{"font-weight":"10","font-size":"16px",position:"relative",top:"-5px"}},[t._v(" "+t._s(new Date(i.time).getMonth()+1)+"/"+t._s(new Date(i.time).getDate())+" "),e("br"),t._v(" "+t._s(new Date(i.time).getHours())+":"+t._s(new Date(i.time).getMinutes())+" ")])]),e("div",{staticClass:"text item",staticStyle:{"white-space":"pre-line",padding:"0px 15px","min-height":"50px"}},[t._v(" "+t._s(i.content)+" ")]),e("div",{staticStyle:{display:"flex","justify-content":"flex-end"}},[e("span",{staticStyle:{"font-weight":"bold",color:"#0043a1","text-shadow":"0px 2px 3px rgb(73,230,255)",position:"relative",top:"5px"}},[t._v(" "+t._s(i.likenum)+" ")]),e("el-button",{staticStyle:{"margin-left":"10px"},attrs:{icon:"el-icon-delete-solid",size:"small",type:"danger"},on:{click:function(e){return t.delPost2(i.id)}}},[t._v("删除")])],1)])],1)})),1),0===t.Post2tableData.length?e("el-empty"):t._e()],1)])],1),e("el-button",{staticClass:"floating-button",attrs:{circle:"",icon:"el-icon-plus",type:"primary"},on:{click:t.update}}),t.isVisible?e("el-button",{staticClass:"scroll-to-top",attrs:{circle:"",icon:"el-icon-top"},on:{click:t.scrollToTop}}):t._e(),e("el-dialog",{attrs:{"before-close":t.handleClose,visible:t.centerDialogVisible,fullscreen:t.isMobile,center:"",title:"发表",width:"80%"},on:{"update:visible":function(e){t.centerDialogVisible=e}}},[e("el-form",{ref:"form",attrs:{model:t.form,rules:t.rules,"label-width":"80px","status-icon":""}},[e("el-form-item",{staticStyle:{position:"relative",left:"5vw"},attrs:{label:"标题",prop:"title"}},[e("el-col",{attrs:{span:20}},[e("el-input",{staticStyle:{"font-size":"20px","font-weight":"bold"},attrs:{placeholder:"请输入标题",type:"textarea"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1)],1)],1),e("el-row",{directives:[{name:"loading",rawName:"v-loading",value:t.quillUpdateImg,expression:"quillUpdateImg"}]},[e("quill-editor",{ref:"myQuillEditor",attrs:{options:t.editorOption},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),e("el-upload",{staticClass:"avatar-uploader",attrs:{action:`${this.postUrl}/files/upPost`,"show-file-list":!1,"on-success":t.handleAvatarSuccess,"on-error":t.handleAvatarError,"before-upload":t.beforeAvatarUpload}}),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.centerDialogVisible=!1,this.loading=!1}}},[t._v("取 消")]),e("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.save}},[t._v(t._s(t.loading?"提交中 ...":"确 定"))])],1)],1)],1)},a=[],l=i(7715),o={name:"UserText",data(){return{isMobile:!1,isVisible:!1,centerDialogVisible:!1,quillUpdateImg:!1,loading:!1,user:JSON.parse(sessionStorage.getItem("CurUser")),activeName:"first",pageSize:5,pageNum:1,total:1,text:"",tableData:[],Post2tableData:[],form:{name:"",title:""},rules:{name:[{required:!0,message:"正文不得为空",trigger:"blur"}],title:[{required:!0,message:"标题不得为空",trigger:"blur"}]},editorOption:{placeholder:"请在这里输入内容",modules:{toolbar:{container:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],[{align:[]}],["clean"],["image"]],handlers:{image:function(t){t?document.querySelector(".avatar-uploader input").click():this.quill.format("image",!1)}}}}}}},methods:{loadPost(){this.$axios.post(this.$httpUrl+"/post/listPage",{pageSize:this.pageSize,pageNum:this.pageNum,param:{userid:this.user.id,name:this.text}}).then((t=>t.data)).then((t=>{200===t.code?(this.tableData=[...this.tableData,...t.data],this.total=t.total):alert("获取失败")}))},searchLoad(){this.tableData=[],this.pageNum=1,this.loadPost()},autoLoad(){this.pageNum+=1,this.loadPost()},loadPost2(){this.$axios.post(this.$httpUrl+"/post2/listPage",{param:{userId:this.user.id}}).then((t=>t.data)).then((t=>{200===t.code&&(this.Post2tableData=t.data)}))},restParam(){this.text="",this.tableData=[],this.pageNum=1,this.loadPost()},save(){this.$refs["form"].validate((t=>{if(!t)return!1;{this.loading=!0;let t=this.form.name.replace(/<pre class="ql-syntax" spellcheck="false">/g,'<pre class="ql-syntax line-numbers language-js" spellcheck="false"><code class="language-js">');t=t.replace(/<\/pre>/g,"</code></pre>"),this.$axios.post(this.$httpUrl+"/post/save",{userid:this.user.id,name:t,title:this.form.title}).then((t=>t.data)).then((t=>{200===t.code?(this.centerDialogVisible=!1,this.$notify({title:"感谢您的贡献，"+this.user.name,message:"上传成功",type:"success"}),this.loadPost(),this.loading=!1):(this.$notify.error({title:"oops！发生了一些问题",message:"服务器开小差啦~请稍后再试"}),this.loading=!1)})),this.resetForm("form")}}))},update(){this.centerDialogVisible=!0,this.$nextTick((()=>{this.resetForm("form")}))},like(t){this.$axios.get(this.$httpUrl+"/post/like?id="+t).then((t=>t.data)).then((t=>{200===t.code?(this.$message({showClose:!0,message:"点赞成功",type:"success"}),this.loadPost()):this.$message({showClose:!0,message:"服务器开小差啦~请稍后重试",type:"error"})}))},del(t){this.$confirm("确认删除这条帖子吗？").then((()=>{this.$axios.get(this.$httpUrl+"/post/delete?id="+t).then((t=>t.data)).then((t=>{200===t.code?(this.$message({showClose:!0,message:"删除成功",type:"success"}),this.restParam()):this.$message({showClose:!0,message:"服务器开小差啦~请稍后重试",type:"error"})}))})).catch((()=>{}))},resetForm(t){this.$refs[t].resetFields()},copy(t){const e=document.createElement("textarea");e.textContent=t,e.style.position="fixed",document.body.appendChild(e),e.select();try{document.execCommand("copy"),this.$notify({title:"内容已复制",message:"您可以粘贴分享",type:"success"})}catch(i){return this.$notify({title:"复制失败",type:"error"}),!1}finally{document.body.removeChild(e)}},handleScroll(){this.isVisible=window.scrollY>100},scrollToTop(){window.scrollTo({top:0,behavior:"smooth"})},handleClose(t){this.$confirm("确认关闭？您的信息不会保存").then((()=>{t()})).catch((()=>{}))},delPost2(t){this.$confirm("确认删除这条评论吗？").then((()=>{this.$axios.get(this.$httpUrl+"/post2/delete?id="+t).then((t=>t.data)).then((t=>{200===t.code?(this.$message({showClose:!0,message:"删除成功",type:"success"}),this.loadPost2()):this.$message({showClose:!0,message:"服务器开小差啦~请稍后重试",type:"error"})}))})).catch((()=>{}))},checkIfMobile(){this.isMobile=window.innerWidth<768},handleAvatarSuccess(t){let e=this.$refs.myQuillEditor.quill;if(null!==t.sinaPath){let i=e.selection.savedRange.index;e.insertEmbed(i,"image",t.data),e.setSelection(i+1),this.quillUpdateImg=!1}else this.$message.error("图片插入失败")},beforeAvatarUpload(t){console.log(t),this.quillUpdateImg=!0},handleAvatarError(){this.quillUpdateImg=!1,this.$message.error("图片插入失败")}},beforeMount(){this.user=JSON.parse(sessionStorage.getItem("CurUser")),this.loadPost(),this.loadPost2()},created(){window.addEventListener("scroll",this.handleScroll)},destroyed(){window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.checkIfMobile)},mounted(){this.checkIfMobile(),window.addEventListener("resize",this.checkIfMobile)},components:{quillEditor:l.quillEditor}},n=o,r=i(1001),c=(0,r.Z)(n,s,a,!1,null,"885e6aaa",null),p=c.exports}}]);
//# sourceMappingURL=575.887f7bc1.js.map